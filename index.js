var fs = require("fs");
var child_process = require("child_process");
var pathExists = require("path-exists");
var Promise = require("bluebird");
function writefile(file, conf, list) {
    for (var i = 0; i < list.length; i++) {
        conf = conf + "\n" + "network={";
        for (var o = 0; o < Object.keys(list[i]).length; o++) {
            conf = conf + "\n" + Object.keys(list[i])[o] + "=" + list[i][Object.keys(list[i])[o]];
        }
        conf = conf + "\n" + "}";
    }
    fs.writeFileSync(file, conf, { encoding: "utf-8" });
}
function fromlinetowpanets(lines) {
    var conf = "";
    var nets = [];
    var net;
    var start = false;
    var firstnet = false;
    var endnetwork = true;
    for (var i = 0; i < lines.length; i++) {
        var checkline = lines[i].replace(/\t/g, "");
        if (checkline[0] != "#" || (checkline[0] == "#" && checkline[3] == "k" && checkline.split("psk").length == 2)) {
            if (checkline.split("etwork").length == 2 && endnetwork) {
                start = true;
                firstnet = true;
                endnetwork = false;
                net = {};
            }
            else if (checkline.replace(/ /g, "")[0] == "}" && firstnet) {
                endnetwork = true;
                firstnet = false;
                nets.push(net);
            }
            else if (firstnet && checkline.split("=").length == 2) {
                net[checkline.split("=")[0].replace(/ /g, "")] = checkline.split("=")[1];
            }
            else if (!start && checkline != "") {
                if (conf != "") {
                    conf = (conf + "\n" + checkline);
                }
                else {
                    conf = (checkline);
                }
            }
        }
    }
    return { list: nets, conf: conf };
}
var WpaMan = (function () {
    function WpaMan(file) {
        this.conf = "";
        if (!pathExists.sync(file)) {
            throw Error("path exists not founded");
        }
        var wpafilelines = fs.readFileSync(file, "utf-8").split("\n");
        var obj = fromlinetowpanets(wpafilelines);
        this.conf = obj.conf;
        this.list = obj.list;
        this.file = file;
    }
    WpaMan.prototype.add = function (essid, password, priority) {
        var exist;
        var nets = [];
        var list = this.list;
        var conf = this.conf;
        var file = this.file;
        return new Promise(function (resolve, reject) {
            if (password.length < 8) {
                reject("passphrase must be 8 characters minimum");
            }
            else {
                child_process.exec("wpa_passphrase \"" + essid + "\" \"" + password + "\"", function (err, stdout, stderr) {
                    if (err || stderr) {
                        console.log(err);
                        console.log(stderr);
                        reject("error on wpa_passphrase");
                    }
                    var wpafilelines = stdout.toString("utf-8").split('\n');
                    var newnets = fromlinetowpanets(wpafilelines).list;
                    for (var i = 0; i < list.length; i++) {
                        exist = false;
                        for (var l = 0; l < newnets.length; l++) {
                            if (list[i].ssid == newnets[l].ssid) {
                                exist = true;
                            }
                        }
                        if (!exist) {
                            nets.push(list[i]);
                        }
                    }
                    for (var l = 0; l < newnets.length; l++) {
                        nets.push(newnets[l]);
                    }
                    list.length = 0;
                    for (var l = 0; l < nets.length; l++) {
                        list.push(nets[l]);
                    }
                    writefile(file, conf, list);
                    resolve(true);
                });
            }
        });
    };
    WpaMan.prototype.remove = function (ssid) {
        var list = this.list;
        var conf = this.conf;
        var file = this.file;
        return new Promise(function (resolve, reject) {
            var relist = [];
            var exists = false;
            for (var i = 0; i < list.length; i++) {
                if (list[i].ssid != '"' + ssid + '"') {
                    relist.push(list[i]);
                }
                else {
                    exists = true;
                }
            }
            if (exists) {
                list.length = 0;
                for (var i = 0; i < relist.length; i++) {
                    list.push(relist[i]);
                }
                writefile(file, conf, list);
            }
            resolve(true);
        });
    };
    return WpaMan;
})();
module.exports = WpaMan;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbIndyaXRlZmlsZSIsImZyb21saW5ldG93cGFuZXRzIiwiV3BhTWFuIiwiV3BhTWFuLmNvbnN0cnVjdG9yIiwiV3BhTWFuLmFkZCIsIldwYU1hbi5yZW1vdmUiXSwibWFwcGluZ3MiOiJBQUFBLElBQVksRUFBRSxXQUFNLElBQUksQ0FBQyxDQUFBO0FBQ3pCLElBQVksYUFBYSxXQUFNLGVBQWUsQ0FBQyxDQUFBO0FBRS9DLElBQVksVUFBVSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQzFDLElBQVksT0FBTyxXQUFNLFVBQVUsQ0FBQyxDQUFBO0FBV3BDLG1CQUFtQixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQVk7SUFDdkNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1FBQ25DQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxXQUFXQSxDQUFDQTtRQUNqQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFFbkRBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBRzFGQSxDQUFDQTtRQUVEQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQTtJQUU3QkEsQ0FBQ0E7SUFHREEsRUFBRUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsRUFBRUEsSUFBSUEsRUFBRUEsRUFBRUEsUUFBUUEsRUFBRUEsT0FBT0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7QUFFeERBLENBQUNBO0FBR0QsMkJBQTJCLEtBQUs7SUFDNUJDLElBQUlBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO0lBQ2RBLElBQUlBLElBQUlBLEdBQVdBLEVBQUVBLENBQUNBO0lBQ3RCQSxJQUFJQSxHQUFHQSxDQUFDQTtJQUNSQSxJQUFJQSxLQUFLQSxHQUFHQSxLQUFLQSxDQUFDQTtJQUNsQkEsSUFBSUEsUUFBUUEsR0FBR0EsS0FBS0EsQ0FBQ0E7SUFDckJBLElBQUlBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBO0lBRXRCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtRQUNwQ0EsSUFBSUEsU0FBU0EsR0FBR0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFHNUNBLEVBQUVBLENBQUNBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLFNBQVNBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzVHQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQSxNQUFNQSxJQUFJQSxDQUFDQSxJQUFJQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdERBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBO2dCQUNiQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDaEJBLFVBQVVBLEdBQUdBLEtBQUtBLENBQUNBO2dCQUNuQkEsR0FBR0EsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDYkEsQ0FBQ0E7WUFBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzNEQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtnQkFDbEJBLFFBQVFBLEdBQUdBLEtBQUtBLENBQUNBO2dCQUNqQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFFbkJBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLElBQUlBLFNBQVNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUV0REEsR0FBR0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsU0FBU0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFN0VBLENBQUNBO1lBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLElBQUlB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R0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQ3hCLENBQUM7Z0JBRUQsU0FBUyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFFaEMsQ0FBQztZQUVELE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUVqQixDQUFDLENBQUNBLENBQUFBO0lBQ05BLENBQUNBO0lBRUxILGFBQUNBO0FBQURBLENBN0dBLEFBNkdDQSxJQUFBO0FBRUQsaUJBQVMsTUFBTSxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBjaGlsZF9wcm9jZXNzIGZyb20gXCJjaGlsZF9wcm9jZXNzXCI7XG5cbmltcG9ydCAqIGFzIHBhdGhFeGlzdHMgZnJvbSBcInBhdGgtZXhpc3RzXCI7XG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xuXG5pbnRlcmZhY2UgSXdwYSB7XG5cbiAgICBzc2lkOiBzdHJpbmc7XG4gICAgcGFzc3dvcmQ/OiBzdHJpbmc7XG4gICAgZW5jb2RlZFBhc3N3b3JkOiBzdHJpbmc7XG4gICAgcHJpb3JpdHk6IG51bWJlcjtcblxufVxuXG5mdW5jdGlvbiB3cml0ZWZpbGUoZmlsZSwgY29uZiwgbGlzdDogSXdwYVtdKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbmYgPSBjb25mICsgXCJcXG5cIiArIFwibmV0d29yaz17XCI7XG4gICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgT2JqZWN0LmtleXMobGlzdFtpXSkubGVuZ3RoOyBvKyspIHtcblxuICAgICAgICAgICAgY29uZiA9IGNvbmYgKyBcIlxcblwiICsgT2JqZWN0LmtleXMobGlzdFtpXSlbb10gKyBcIj1cIiArIGxpc3RbaV1bT2JqZWN0LmtleXMobGlzdFtpXSlbb11dO1xuXG5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbmYgPSBjb25mICsgXCJcXG5cIiArIFwifVwiO1xuXG4gICAgfVxuXG5cbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGUsIGNvbmYsIHsgZW5jb2Rpbmc6IFwidXRmLThcIiB9KTtcblxufVxuXG5cbmZ1bmN0aW9uIGZyb21saW5ldG93cGFuZXRzKGxpbmVzKSB7XG4gICAgbGV0IGNvbmYgPSBcIlwiO1xuICAgIGxldCBuZXRzID0gPEl3cGFbXT5bXTtcbiAgICBsZXQgbmV0O1xuICAgIGxldCBzdGFydCA9IGZhbHNlO1xuICAgIGxldCBmaXJzdG5ldCA9IGZhbHNlO1xuICAgIGxldCBlbmRuZXR3b3JrID0gdHJ1ZTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGNoZWNrbGluZSA9IGxpbmVzW2ldLnJlcGxhY2UoL1xcdC9nLCBcIlwiKTtcblxuXG4gICAgICAgIGlmIChjaGVja2xpbmVbMF0gIT0gXCIjXCIgfHwgKGNoZWNrbGluZVswXSA9PSBcIiNcIiAmJiBjaGVja2xpbmVbM10gPT0gXCJrXCIgJiYgY2hlY2tsaW5lLnNwbGl0KFwicHNrXCIpLmxlbmd0aCA9PSAyKSkge1xuICAgICAgICAgICAgaWYgKGNoZWNrbGluZS5zcGxpdChcImV0d29ya1wiKS5sZW5ndGggPT0gMiAmJiBlbmRuZXR3b3JrKSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGZpcnN0bmV0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBlbmRuZXR3b3JrID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgbmV0ID0ge307XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNoZWNrbGluZS5yZXBsYWNlKC8gL2csIFwiXCIpWzBdID09IFwifVwiICYmIGZpcnN0bmV0KSB7XG4gICAgICAgICAgICAgICAgZW5kbmV0d29yayA9IHRydWU7XG4gICAgICAgICAgICAgICAgZmlyc3RuZXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBuZXRzLnB1c2gobmV0KTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChmaXJzdG5ldCAmJiBjaGVja2xpbmUuc3BsaXQoXCI9XCIpLmxlbmd0aCA9PSAyKSB7XG5cbiAgICAgICAgICAgICAgICBuZXRbY2hlY2tsaW5lLnNwbGl0KFwiPVwiKVswXS5yZXBsYWNlKC8gL2csIFwiXCIpXSA9IGNoZWNrbGluZS5zcGxpdChcIj1cIilbMV07XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXN0YXJ0ICYmIGNoZWNrbGluZSAhPSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmYgIT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBjb25mID0gKGNvbmYgKyBcIlxcblwiICsgY2hlY2tsaW5lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25mID0gKGNoZWNrbGluZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cblxuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHJldHVybiB7IGxpc3Q6IG5ldHMsIGNvbmY6IGNvbmYgfTtcblxuXG59XG5cbmNsYXNzIFdwYU1hbiB7XG4gICAgZmlsZTogc3RyaW5nO1xuICAgIGxpc3Q6IEl3cGFbXTtcbiAgICBjb25mID0gXCJcIjtcbiAgICBjb25zdHJ1Y3RvcihmaWxlOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCFwYXRoRXhpc3RzLnN5bmMoZmlsZSkpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwicGF0aCBleGlzdHMgbm90IGZvdW5kZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgd3BhZmlsZWxpbmVzID0gZnMucmVhZEZpbGVTeW5jKGZpbGUsIFwidXRmLThcIikuc3BsaXQoXCJcXG5cIik7XG5cbiAgICAgICAgbGV0IG9iaiA9IGZyb21saW5ldG93cGFuZXRzKHdwYWZpbGVsaW5lcyk7XG4gICAgICAgIHRoaXMuY29uZiA9IG9iai5jb25mO1xuICAgICAgICB0aGlzLmxpc3QgPSBvYmoubGlzdDtcblxuICAgICAgICB0aGlzLmZpbGUgPSBmaWxlO1xuICAgIH1cblxuICAgIGFkZChlc3NpZDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nLCBwcmlvcml0eT86IG51bWJlcikge1xuICAgICAgICBsZXQgZXhpc3Q7XG4gICAgICAgIGxldCBuZXRzID0gW107XG4gICAgICAgIGxldCBsaXN0ID0gdGhpcy5saXN0O1xuICAgICAgICBsZXQgY29uZiA9IHRoaXMuY29uZjtcbiAgICAgICAgbGV0IGZpbGUgPSB0aGlzLmZpbGU7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGlmIChwYXNzd29yZC5sZW5ndGggPCA4KSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KFwicGFzc3BocmFzZSBtdXN0IGJlIDggY2hhcmFjdGVycyBtaW5pbXVtXCIpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNoaWxkX3Byb2Nlc3MuZXhlYyhcIndwYV9wYXNzcGhyYXNlIFxcXCJcIiArIGVzc2lkICsgXCJcXFwiIFxcXCJcIiArIHBhc3N3b3JkICsgXCJcXFwiXCIsIGZ1bmN0aW9uKGVyciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyciB8fCBzdGRlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzdGRlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiZXJyb3Igb24gd3BhX3Bhc3NwaHJhc2VcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsZXQgd3BhZmlsZWxpbmVzID0gc3Rkb3V0LnRvU3RyaW5nKFwidXRmLThcIikuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgbmV3bmV0cyA9IGZyb21saW5ldG93cGFuZXRzKHdwYWZpbGVsaW5lcykubGlzdDtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCA8IG5ld25ldHMubGVuZ3RoOyBsKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlzdFtpXS5zc2lkID09IG5ld25ldHNbbF0uc3NpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFleGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldHMucHVzaChsaXN0W2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbCA9IDA7IGwgPCBuZXduZXRzLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXRzLnB1c2gobmV3bmV0c1tsXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsaXN0Lmxlbmd0aCA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbCA9IDA7IGwgPCBuZXRzLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2gobmV0c1tsXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlZmlsZShmaWxlLCBjb25mLCBsaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgfSlcblxuICAgIH1cblxuICAgIHJlbW92ZShzc2lkOiBzdHJpbmcpIHtcblxuICAgICAgICBsZXQgbGlzdCA9IHRoaXMubGlzdDtcbiAgICAgICAgbGV0IGNvbmYgPSB0aGlzLmNvbmY7XG4gICAgICAgIGxldCBmaWxlID0gdGhpcy5maWxlO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgbGV0IHJlbGlzdCA9IDxJd3BhW10+W107XG4gICAgICAgICAgICBsZXQgZXhpc3RzID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGxpc3RbaV0uc3NpZCAhPSAnXCInICsgc3NpZCArICdcIicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsaXN0LnB1c2gobGlzdFtpXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGV4aXN0cykge1xuICAgICAgICAgICAgICAgIGxpc3QubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2gocmVsaXN0W2ldKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHdyaXRlZmlsZShmaWxlLCBjb25mLCBsaXN0KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNvbHZlKHRydWUpXG5cbiAgICAgICAgfSlcbiAgICB9XG5cbn1cblxuZXhwb3J0ID0gV3BhTWFuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
